# Advanced-get-biji-Skills 开发需求（v0.1）

## 1. 项目目标与定位

**项目名称**：Advanced-get-biji-Skills（Get笔记智能技能系统专业版）

**核心目标**：  
在已有「get 笔记」MCP 的基础上，叠加搜索和LLM知识能力，依据SCAN框架，构建一个多角色协同的 Skills 体系，让 AI 能够围绕用户目标（如示例：  
>「基于我的笔记，分析限流方案风险并写博客」  
完成从**研究 → 写作 → 验证**的一整套高质量工作流，而不是单纯"帮忙查笔记"和"基于MCP的检索输出"，能够稳定，全面，和客观的保留证据，提供深度报告，并保留信源，标准分歧点作为高价值输出。

**关键特性**：

- 多角色：
  - Researcher Skill（研究员）
  - Writer Skill（写作者）
  - Validator Skill（验证员）
  -（可选后续）Connector Skill（关联挖掘）
- 多源信息：
  - get-biji-MCP：Get笔记 / 知识库
  - metaso搜索-mcp: 外部AI搜索/AI整理后的智能搜索结果
  - knows知识库搜索 -mcp：医学论文和证据 /医学研究
  - pubmed_server - mcp: pubmed知识库证据
  - Tavily、BingCN、Ollama等：通用网络搜索
  - LLM：自身通识与推理能力
- 多阶段方法论：  
  引入医学研究风格的 **SCAN 框架** 作为 Research Skill 的研究指导流程  
  （S：Survey/Scout，C：Clarify/Compare，A：Analyze/Assess，N：Navigate/Note）
- 多层流程：
  - 分层调用（Routing 层 → Role Skills 层 → Tools 层 → Fusion 层）
  - 并行探索（MCP + Search + LLM 同步拉取 & 处理）
  - 最终融合（冲突检测 + 权重 + 决策 + 结构化输出）

---

## 2. 整体架构需求

### 2.1 分层结构

从"Prompt 到最终回答"的整体链路要求如下：

1. **Routing Layer（路由层）**
   - 输入：用户原始提问（例如：  
     「基于我的笔记，分析限流方案风险并写博客」）
   - 功能需求：
     - 意图识别：判断是否包含：
       - 研究意图（analysis / research）
       - 写作意图（write / blog / 文档）
       - 验证/溯源需求（依据 / 风险 / 是否有记录）
     - 任务拆解：将用户需求拆成一个或多个子任务：
       - 例：
         - 子任务1：基于笔记 + 外部资料，研究"限流方案"的风险
         - 子任务2：基于研究结果，生成一篇可发布的博客
     - 角色分配：
       - 将子任务1分配给 Researcher Skill
       - 将子任务2分配给 Writer Skill
       - 如有"验证/是否记录过"等语义，附加调用 Validator Skill
     - MCP 工具路由策略：
       - 必须使用 getBiji：内部知识库检索
       - 必须使用 Metaso：获取更完善的通用信息
       - 必须使用 PubMed：医学文献证据检索
       - 必须使用 Knows：医学指南和权威文献检索
       - 可选使用其他搜索工具：Tavily、BingCN、Ollama 等
   - 输出（面向下游 Role Skill 的统一结构）：
     ```json
     {
       "tasks": [
         {
           "role": "Researcher",
           "mode": "research",
           "topic": "微服务限流方案风险分析",
           "origin_prompt": "基于我的笔记，分析限流方案风险并写博客"
         },
         {
           "role": "Writer",
           "mode": "blog",
           "depends_on": "Researcher",
           "style": "技术博客",
           "target_audience": "中高级后端工程师"
         }
       ]
     }
     ```

2. **Role Skills Layer（多角色技能层）**
   - 至少包含三个初始 Skill：
     - `getbiji-researcher-skill`
     - `getbiji-writer-skill`
     - `getbiji-validator-skill`
   - 每个 Skill 内部都有自己的明确工作流说明（尤其 Researcher 采用 SCAN）。

3. **Tools Layer（工具层）**
   - MCP：`getBiji` 相关接口（如 `searchNotes`, `getNoteById`, `listByTag`）
   - MCP：`Metaso` 智能搜索接口
   - MCP：`PubMed` 医学文献检索接口
   - MCP：`Knows` 医学知识库接口
   - MCP：其他搜索工具（Tavily、BingCN、Ollama 等）
   - LLM：基础推理（不走额外工具时的常规回答）

4. **Fusion Layer（融合层）**
   - 核心责任：  
     对 MCP / Search / LLM 三路返回信息做：
     - 冲突检测（内容是否一致）
     - 权重评估（时效性 / 权威性 / 支持度）
     - 信息融合（合并为统一观点集合）
     - 决策支持（为上层角色提供"推荐结论 + 风险提示"）

---

## 3. SCAN 研究框架在系统中的落地

### 3.1 SCAN 四阶段设计（针对 Researcher Skill）

以一个 Researcher Skill 对"限流方案风险分析"为例：

1. **S：Survey/Scout（侦察）**
   - 目标：搞清楚"到底要研究什么 + 需要哪些信息源"
   - 系统行为要求：
     - 对用户问题进行语义解析：
       - 识别核心对象：限流方案
       - 识别任务目标：风险分析 + 博客写作前置研究
     - 生成初步查询子主题：
       - 例如：「限流算法」「网关限流」「服务端限流」「熔断与降级」「线上事故」「性能瓶颈」
     - 调用 MCP：
       - 使用关键词 + tag 搜索，**仅拉元数据**（标题 / 标签 / 时间 / 摘要），限制前 N 条（如 10 条）
     - 调用 Metaso：
       - 搜「2024/2025 微服务限流最佳实践」「rate limiting production patterns」等，限制前 M 条（如 5 条），只取标题和摘要
     - 调用 PubMed（如涉及医学领域）：
       - 检索相关研究和数据
     - 调用 LLM（自身知识）：
       - 生成一个"标准限流方案与风险维度"的骨架（比如：算法层面 / 系统层面 / 运维配置层面）
   - 阶段输出：
     - 研究目标说明
     - 信息需求清单（需要从笔记 / 搜索 / 模型分别拿什么）

2. **C：Clarify/Compare（澄清与比较）**
   - 目标：评估不同来源的信息质量并做初步对比
   - 系统行为要求：
     - 为每条信息打标签：
       - 来源类型：`note` / `metaso` / `pubmed` / `knows` / `web` / `llm`
       - 时间：写作/发布时间
     - 基于规则给出基础权重（可后续调参）：
       - 内部实践笔记：0.7
       - 官方文档 / 大厂博客：0.8–0.9
       - 医学指南/权威文献：0.9-1.0
       - 普通博客：0.4–0.6
       - 仅 LLM 主观推理：0.3–0.4
     - 冲突检测（简单版本即可）：
       - 找到对同一子问题给出不同结论的条目（例如：一个笔记认为"网关限流足够"，另一篇认为"必须下沉到服务端"）
   - 阶段输出：
     - 信息质量矩阵（每个要点对应的来源+权重）
     - 冲突列表（哪些点存在明显分歧）

3. **A：Analyze/Assess（分析与评估）**
   - 目标：在 C 阶段的基础上做深度分析，得出带权重的结论
   - 系统行为要求：
     - 综合各来源，对每个关键问题给出：
       - 共识观点（大部分来源都支持）
       - 少数派观点（有但不占主流）
     - 结合限流主题，要求至少输出：
       - 主要方案清单（网关限流、服务端限流、客户端限流、分布式令牌桶等）
       - 每种方案的：
         - 优点
         - 风险点（从你的事故笔记中提炼）
         - 适用场景
     - 明确不确定性：
       - 哪些结论因为资料较旧 / 资料少而需要打"低置信度"
   - 阶段输出：
     - 一份结构化的分析草稿，如：
       - 风险分类（可用表格形式：维度 × 方案）
       - 关键结论列表
       - 每个结论的置信度与主要依据（只记 ID 或 URL）

4. **N：Navigate/Note（导航与记录）**
   - 目标：给出可执行决策建议 + 形成最终可复用的"研究结论"
   - 系统行为要求：
     - 输出结构要求：
       1. 背景与问题定义
       2. 现有方案概览
       3. 你的笔记中暴露出的坑和教训
       4. 综合后的推荐方案（针对你自己的环境）
       5. 风险与备选预案
       6. 引用索引（笔记ID + 搜索结果URL）
       7. 每一大结论的置信度评级
     - 这个研究结果将作为 Writer Skill 的输入。

---

## 4. 多角色 Skills 的具体需求

### 4.1 Researcher Skill（getbiji-researcher-skill）

- 职责：
  - 围绕一个研究主题，执行完整 SCAN 流程
  - 产出结构化的研究报告（而不仅是片段回答）
- 输入：
  - 主题 / 原始用户问题
  - Routing 层拆解后的研究子任务描述
- 输出：
  - 结构化 JSON 或 Markdown：
    - 研究背景
    - 关键问题列表
    - 对应结论 + 依据 + 置信度
    - 风险与未决问题
- 必须行为：
  - 不直接长篇写作，而是偏"决策说明书"
  - 显式区分：来自笔记 vs 来自搜索 vs 来自 LLM 的观点

### 4.2 Writer Skill（getbiji-writer-skill）

- 职责：
  - 接收 Researcher 的结构化研究结果，为指定受众/场景生成可读内容
  - 示例：技术博客、内部分享文档、设计说明等
- 输入：
  - Researcher Skill 的输出（研究报告）
  - 写作目标：例如"公众号风格技术博客"
- 输出：
  - 完整文章草稿或详细大纲（含标题、小节结构、关键论点）
- 必须行为：
  - 保留研究中的"个人实践味道"（优先引用你的笔记中的故事/事故）
  - 在合适位置插入"引用标记"（例如 [Note#12], [Web#3]）

### 4.3 Validator Skill（getbiji-validator-skill）

- 职责：
  - 对任意一段 AI 生成的结论或文稿进行"基于笔记的校验"
- 输入：
  - 一段候选回答或方案（可以是 Researcher 或 Writer 的产出）
- 系统行为要求：
  - 从中提取关键主张（如："我们推荐使用服务端令牌桶进行限流"）
  - 对每一个主张：
    - 在 MCP 笔记中检索相关内容，统计：
      - 支持性的笔记数
      - 反对/质疑性笔记数
    - 在外部搜索结果中检索是否有类似建议
  - 按照权重给每条主张一个校验结论：
    - "强烈支持 / 有部分支持 / 缺乏支持 / 有明显反例"
- 输出：
  - 一个"验证报告"：
    - 主张列表 + 支持度 + 相关笔记ID +（可选）搜索来源
    - 对整体回答的可信度评级
    - 建议是否需要重写/弱化某些结论

---

## 5. 工具调用与并行探索需求

### 5.1 工具种类

1. **MCP：getBiji 笔记系统**（必需）
   - 必需支持：
     - 按关键词 / tag 搜索，返回元数据列表
     - 按 ID 获取全文
     - 按时间排序
   - 作用：内部知识库检索，个人/团队笔记和经验

2. **MCP：Metaso 搜索**（必需）
   - 必需支持：
     - 智能搜索接口，返回结构化结果
     - 支持上下文感知搜索
     - 返回来源和可信度评分
   - 作用：获取更完善的通用信息和知识

3. **MCP：PubMed 数据服务**（必需）
   - 必需支持：
     - 文献检索（pubmed_search, pubmed_quick_search）
     - 文献详情获取（pubmed_get_details）
     - 关键信息提取（pubmed_extract_key_info）
     - 全文状态检测（pubmed_detect_fulltext）
     - 批量查询（pubmed_batch_query）
   - 作用：医学证据和学术文献检索

4. **MCP：Knows 医学知识库**（必需）
   - 必需支持：
     - 医学指南和共识检索
     - 会议文献搜索
     - 中外医学数据库访问
     - 证据级别分类
   - 作用：复制医学证据和权威文献

5. **可选 MCP 工具**
   - Tavily 搜索：通用网络搜索
   - BingCN 搜索：中文网络搜索
   - Ollama 网络搜索：本地化搜索能力
   - 时间工具：时间相关查询
   - Sequential Thinking：复杂问题分解

6. **LLM 自身知识**
   - 用于：
     - 基础概念解释
     - 生成研究框架草稿
     - 作为补充视角，但权重较低
   - 作用：推理和知识整合

### 5.2 并行探索与融合

- 需求：
  - 在 SCAN 的 S 阶段，允许多种 MCP 工具 **并行检索/生成**
    - getBiji：内部笔记和实践经验
    - Metaso：通用智能搜索结果
    - PubMed：医学文献证据
    - Knows：医学指南和权威资源
    - 其他可选搜索工具：补充信息来源
  - C 阶段统一对多路结果做：
    - 冲突检测（识别不同来源间的矛盾信息）
    - 权重分配（根据来源权威性、时效性、证据等级进行评分）
    - 权重参考标准：
      - 内部实践笔记：高权重（0.8-0.9）
      - 医学指南/权威文献：最高权重（0.9-1.0）
      - 搜索引擎结果：中等权重（0.5-0.7）
      - LLM 推理：较低权重（0.3-0.5）
  - A / N 阶段在融合后的统一"证据池"上进行分析和输出

---

## 6. 最终输出要求

无论用户的原始任务是"研究 + 写作"、"单纯问答"还是"验证"，最终返回给用户时的结果都应满足：

1. **结构化**：
   - 明确的标题、小节、列表
   - 对于"分析类问题"，至少包含：
     - 背景
     - 方案或观点列表
     - 风险与权衡
     - 建议与下一步行动
2. **溯源**：
   - 每个重要结论，标注来源：
     - 来自笔记：Note#ID
     - 来自搜索：Web#ID
     - 来自模型推断：Model（无外部证据）
3. **置信度**：
   - 为整体结论和关键点给出"高/中/低"置信度
   - 简要说明影响置信度的因素（例如：笔记时间过旧 / 外部资料有限）
4. **风险提示**：
   - 对不确定或存在明显分歧的地方，必须显式提示  
     （而不是假装结论非常确定）

---

## 7. 实施建议（MVP 优先级）

1. **第一阶段（MVP）**
   - 实现：
     - Routing Layer（简单规则版）
     - Researcher Skill（完整 SCAN，但可以先弱化 C/A，也就是先做信息聚合+初步分析）
     - MCP + Search 基本调用
   - 目标：
     - 能对类似「基于我的笔记，分析限流方案风险」的纯研究问题，产出一份有引用的分析报告

2. **第二阶段**
   - 加：
     - Writer Skill：可以把第一阶段的报告转成博客草稿
     - Validator Skill：对关键结论做笔记级验证，输出"依据/风险"

3. **第三阶段**
   - 优化：
     - 冲突检测算法与权重策略
     - 对更多类型任务的路由（不仅限于限流，扩展到架构设计、复盘、方案选型等）

---